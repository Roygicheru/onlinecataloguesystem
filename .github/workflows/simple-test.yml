name: ğŸ› ï¸ Full-Stack CI/Build Pipeline

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  # -------------------------------------------------------------------
  # 1. Backend CI Job (Spring Boot/Maven)
  # -------------------------------------------------------------------
  backend-ci:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“‚ Checkout Code
        uses: actions/checkout@v4

      - name: â˜• Set up Java 17
        uses: actions/setup-java@v4
        with:
          java-version: '17' # Standard Java LTS for modern Spring Boot
          distribution: 'temurin'
          cache: 'maven' # Speeds up subsequent runs by caching dependencies

      - name: ğŸ”¨ Build and Package Backend
        # This compiles the code, runs unit tests, and packages the app.
        run: |
          echo "Starting Maven build for Spring Boot..."
          # Assuming the Spring Boot project is in a subdirectory named 'backend'
          mvn -B clean package --file ocsspring/pom.xml

      - name: âœ… Backend Build Success
        run: echo "Spring Boot build and basic test suite passed successfully."

  # -------------------------------------------------------------------
  # 2. Frontend CI Job (React/Node)
  # -------------------------------------------------------------------
  frontend-ci:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“‚ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Set up Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: '20' # A modern, supported Node.js version
          cache: 'npm'
          # Assuming package-lock.json is in a subdirectory named 'frontend'
          cache-dependency-path: ocsreact/package-lock.json

      - name: ğŸ“¦ Install Dependencies
        # Installs all packages listed in frontend/package.json
        run: npm install
        working-directory: ./ocsreact

      - name: ğŸ§ª Run Basic Frontend Tests
        # Runs the standard npm test script, which usually includes Jest/React testing.
        # Adding --if-present prevents the workflow from failing if no test script is defined.
        run: npm test --if-present
        working-directory: ./ocsreact

      - name: ğŸ—ï¸ Create Production Build (Artifact)
        # Creates the production-ready build folder. This is a critical CI step.
        run: npm run build
        working-directory: ./ocsreact

      - name: âœ… Frontend Build Success
        run: echo "React frontend built successfully and ready for deployment."